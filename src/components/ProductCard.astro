---
import type { Product } from "../data/products";

interface Props {
  product: Product;
}

const { product } = Astro.props;

const heatColors: Record<string, string> = {
  Mild: "#4caf50",
  Medium: "#ff9800",
  Hot: "#f44336",
  "Extra Hot": "#b71c1c",
};

const heatDots: Record<string, number> = {
  Mild: 1,
  Medium: 2,
  Hot: 3,
  "Extra Hot": 4,
};

const sauceColors: Record<string, [string, string]> = {
  Mild: ["#e8944a", "#c46a2a"],
  Medium: ["#d4622a", "#a84418"],
  Hot: ["#c43a22", "#8b2210"],
  "Extra Hot": ["#a81a10", "#6a0804"],
};

const bottleId = `bottle-${product.id}`;
---

<div class="card">
  <div class="card-image">
    <svg class="bottle-svg" viewBox="0 0 140 280" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <!-- Glass body gradient - dark reddish-brown like the real bottle -->
        <linearGradient id={`glass-${bottleId}`} x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="#3a0e06" />
          <stop offset="12%" stop-color="#5a1a0a" />
          <stop offset="30%" stop-color="#6e2210" />
          <stop offset="50%" stop-color="#7a2814" />
          <stop offset="70%" stop-color="#5a1a0a" />
          <stop offset="88%" stop-color="#3a0e06" />
          <stop offset="100%" stop-color="#2a0804" />
        </linearGradient>
        <!-- Glass neck gradient -->
        <linearGradient id={`neck-${bottleId}`} x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="#3a0e06" />
          <stop offset="30%" stop-color="#5a1a0a" />
          <stop offset="60%" stop-color="#6e2210" />
          <stop offset="100%" stop-color="#2a0804" />
        </linearGradient>
        <!-- Specular highlight -->
        <linearGradient id={`highlight-${bottleId}`} x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="white" stop-opacity="0" />
          <stop offset="35%" stop-color="white" stop-opacity="0.12" />
          <stop offset="50%" stop-color="white" stop-opacity="0.2" />
          <stop offset="65%" stop-color="white" stop-opacity="0.08" />
          <stop offset="100%" stop-color="white" stop-opacity="0" />
        </linearGradient>
        <!-- Sauce gradient -->
        <linearGradient id={`sauce-${bottleId}`} x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color={sauceColors[product.heat][0]} stop-opacity="0.65" />
          <stop offset="100%" stop-color={sauceColors[product.heat][1]} stop-opacity="0.85" />
        </linearGradient>
        <!-- Cap gradient -->
        <linearGradient id={`cap-${bottleId}`} x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="#111" />
          <stop offset="30%" stop-color="#2a2a2a" />
          <stop offset="70%" stop-color="#222" />
          <stop offset="100%" stop-color="#0a0a0a" />
        </linearGradient>
        <!-- Shadow -->
        <radialGradient id={`shadow-${bottleId}`} cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#000" stop-opacity="0.3" />
          <stop offset="100%" stop-color="#000" stop-opacity="0" />
        </radialGradient>
        <!-- Label area - fire gradient background -->
        <linearGradient id={`fire-bg-${bottleId}`} x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#ff6600" />
          <stop offset="30%" stop-color="#ff3300" />
          <stop offset="60%" stop-color="#cc2200" />
          <stop offset="100%" stop-color="#991100" />
        </linearGradient>
        <!-- Label clip -->
        <clipPath id={`label-clip-${bottleId}`}>
          <rect x="32" y="95" width="76" height="100" rx="3" />
        </clipPath>
      </defs>

      <!-- Drop shadow -->
      <ellipse cx="70" cy="268" rx="42" ry="8" fill={`url(#shadow-${bottleId})`} />

      <!-- === CAP === -->
      <rect x="54" y="4" width="32" height="30" rx="4" fill={`url(#cap-${bottleId})`} />
      <!-- Cap ridges -->
      {Array.from({ length: 8 }).map((_, i) => (
        <line x1={57 + i * 3.5} y1="8" x2={57 + i * 3.5} y2="32" stroke="#444" stroke-width="0.5" opacity="0.35" />
      ))}
      <!-- Cap top highlight -->
      <rect x="54" y="4" width="32" height="4" rx="4" fill="white" opacity="0.06" />
      <!-- Cap ring -->
      <rect x="52" y="30" width="36" height="5" rx="2.5" fill="#1a1a1a" />
      <rect x="52" y="30" width="36" height="2" rx="1" fill="white" opacity="0.05" />

      <!-- === NECK === -->
      <rect x="56" y="34" width="28" height="42" rx="3" fill={`url(#neck-${bottleId})`} />
      <!-- Neck ring -->
      <rect x="50" y="72" width="40" height="6" rx="3" fill="#3a0e06" />
      <rect x="50" y="72" width="40" height="2" rx="1" fill="white" opacity="0.05" />
      <!-- Neck highlight -->
      <rect x="68" y="36" width="4" height="34" rx="2" fill="white" opacity="0.08" />

      <!-- === BODY === -->
      <path d="M28,86 Q28,76 50,76 L90,76 Q112,76 112,86 L112,232 Q112,260 70,260 Q28,260 28,232 Z" fill={`url(#glass-${bottleId})`} />

      <!-- Body left highlight -->
      <path d="M36,88 Q36,80 50,80 L54,80 Q40,82 38,90 L38,228 Q38,244 52,252 Q40,248 36,238 Z" fill="white" opacity="0.06" />
      <!-- Body right highlight -->
      <path d="M82,84 Q86,82 88,84 L88,232 Q88,242 82,248 L82,84 Z" fill={`url(#highlight-${bottleId})`} opacity="0.45" />

      <!-- === SAUCE FILL === -->
      <path d={`M30,115 L110,115 L110,232 Q110,258 70,258 Q30,258 30,232 Z`} fill={`url(#sauce-${bottleId})`} />
      <!-- Sauce meniscus -->
      <ellipse cx="70" cy="115" rx="40" ry="3" fill={sauceColors[product.heat][0]} opacity="0.25" />

      <!-- === LABEL with fire background === -->
      <rect x="32" y="95" width="76" height="100" rx="3" fill={`url(#fire-bg-${bottleId})`} />

      <!-- Logo image on label -->
      <image
        href="/logo.png"
        x="32"
        y="95"
        width="76"
        height="100"
        clip-path={`url(#label-clip-${bottleId})`}
        preserveAspectRatio="xMidYMid slice"
      />

      <!-- Label border -->
      <rect x="32" y="95" width="76" height="100" rx="3" fill="none" stroke="rgba(0,0,0,0.2)" stroke-width="0.5" />

      <!-- Product name below label -->
      <text x="70" y="210" text-anchor="middle" font-size="7" font-weight="900" fill="#fff" font-family="'Arial Black', 'Impact', sans-serif" stroke="#000" stroke-width="0.6" paint-order="stroke">
        {product.name.toUpperCase().split(" ").map((w, i) => (
          <tspan x="70" dy={i === 0 ? "0" : "9"}>{w}</tspan>
        ))}
      </text>

      <!-- === GLASS REFLECTIONS === -->
      <ellipse cx="70" cy="76" rx="42" ry="2" fill="white" opacity="0.04" />
      <ellipse cx="70" cy="256" rx="34" ry="2" fill="white" opacity="0.03" />
    </svg>
  </div>
  <div class="card-body">
    <h3 class="card-name">{product.name}</h3>
    <div class="heat-row">
      <div class="heat-dots">
        {Array.from({ length: 4 }).map((_, i) => (
          <span
            class:list={["dot", { active: i < heatDots[product.heat] }]}
            style={i < heatDots[product.heat] ? `background: ${heatColors[product.heat]}` : ""}
          />
        ))}
      </div>
      <span class="heat-label" style={`color: ${heatColors[product.heat]}`}>
        {product.heat}
      </span>
    </div>
    <p class="card-desc">{product.description}</p>
    <div class="card-footer">
      <span class="price">${product.price.toFixed(2)}</span>
      <button class="add-btn">Add to Cart</button>
    </div>
  </div>
</div>

<style>
  .card {
    background: var(--color-secondary);
    border-radius: 12px;
    overflow: hidden;
    transition: box-shadow 0.3s, transform 0.3s;
  }

  .card:hover {
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
    transform: translateY(-4px);
  }

  .card-image {
    padding: 1.5rem 2rem 0.5rem;
    display: flex;
    justify-content: center;
  }

  .bottle-svg {
    width: 110px;
    height: 220px;
  }

  .card-body {
    padding: 0 1.5rem 1.5rem;
  }

  .card-name {
    font-size: 1.15rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .heat-row {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    margin-bottom: 0.75rem;
  }

  .heat-dots {
    display: flex;
    gap: 4px;
  }

  .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--color-border);
  }

  .dot.active {
    /* color set inline */
  }

  .heat-label {
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .card-desc {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 1.25rem;
    line-height: 1.5;
  }

  .card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .price {
    font-size: 1.2rem;
    font-weight: 700;
  }

  .add-btn {
    padding: 0.55rem 1.2rem;
    background: var(--color-accent);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    font-size: 0.85rem;
    font-weight: 600;
    transition: background 0.2s, transform 0.15s;
  }

  .add-btn:hover {
    background: var(--color-accent-hover);
    transform: translateY(-1px);
  }

  .add-btn:active {
    transform: translateY(0);
  }
</style>
